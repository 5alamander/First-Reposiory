// Generated by CoffeeScript 1.8.0
(function() {
  var Buff, Buff2, d, f, root, t,
    __slice = [].slice,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Buff = (function() {
    Buff.prototype.cost = 0;

    Buff.prototype.atk = 0;

    Buff.prototype.maxHp = 0;

    Buff.prototype.isSilence = false;

    Buff.prototype.owner = {
      removeBuff: function() {
        return console.log('temp remove');
      },
      gs: {
        listen: function() {
          return console.log('temp listen', {
            disListen: function() {
              return console.log('temp disListen');
            }
          });
        }
      }
    };

    Buff.prototype.lifeTime = 1;

    function Buff(initial) {
      var key, value;
      this.turnCount = 0;
      this.tags = [];
      for (key in initial) {
        value = initial[key];
        if (key.indexOf('when') === 0) {
          this.tags.push(key);
        }
        this.decorateBySilence(key, value);
      }
    }

    Buff.prototype.update = function(n) {
      this.lifeTime -= n;
      this.turnCount += n;
      if (!(this.lifeTime > 0)) {
        this.owner.removeBuff(this);
        return;
      }
      if (this.isSilence !== false) {
        return;
      }
      if (this.cost && this.owner.currentCost) {
        this.owner.currentCost += this.cost;
      }
      if (this.atk && this.owner.currentAtk) {
        this.owner.currentAtk += this.atk;
      }
      if (this.maxHp && this.owner.currentMaxHp) {
        this.owner.currentMaxHp += this.maxHp;
      }
      return typeof this.onUpdate === "function" ? this.onUpdate(n) : void 0;
    };

    Buff.prototype.activate = function() {
      var tag, _i, _len, _ref, _results;
      _ref = this.tags;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tag = _ref[_i];
        _results.push(this.owner.gs.listen(this, tag));
      }
      return _results;
    };

    Buff.prototype.destroy = function() {
      var tag, _i, _len, _ref, _results;
      _ref = this.tags;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tag = _ref[_i];
        _results.push(this.owner.gs.disListen(this, tag));
      }
      return _results;
    };

    Buff.prototype.decorateBySilence = function(key, func) {
      if (this[key] != null) {
        throw new Error('the key has already exist');
      }
      return this[key] = function() {
        var args;
        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        if (this.isSilence !== false) {
          return;
        }
        return func.call.apply(func, [this].concat(__slice.call(args)));
      };
    };

    Buff.prototype.decorate2 = function(key, func, object) {
      if (object == null) {
        object = Buff;
      }
      if (object.prototype[key] != null) {
        throw new Error('the key has already exist');
      }
      return object.prototype[key] = function() {
        var args;
        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        return func.call.apply(func, [this].concat(__slice.call(args)));
      };
    };

    return Buff;

  })();

  root = typeof exports !== "undefined" && exports !== null ? exports : window;

  root.Buff = Buff;

  Buff2 = (function(_super) {
    __extends(Buff2, _super);

    function Buff2() {
      return Buff2.__super__.constructor.apply(this, arguments);
    }

    return Buff2;

  })(Buff);

  t = new Buff;

  f = function() {
    return console.log('delete buff');
  };

  t.decorate2('delete', f, Buff);

  d = new Buff2;

  f = function() {
    return console.log('overrid delete buff');
  };

  d.decorate2('delete', f, Buff2);

  t["delete"]();

  d["delete"]();

}).call(this);
